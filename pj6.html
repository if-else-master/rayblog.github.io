<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>BRANCHES</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link href="css/styles.css" rel="stylesheet" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

        <!-- Clipboard.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>

        
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
            <a class="navbar-brand js-scroll-trigger" href="#page-top">
                <span class="d-block d-lg-none">靖杭のBlog</span>
                <span class="d-none d-lg-block"><img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="img/profile.png" alt="..."/></span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#exper">CreateML是什麼</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#education">實作：圖片辨識</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#skills">展示結果</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#interests">結合 SwiftUI</a></li>                       
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#word">心得感想</a></li>                    
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html#pj6">回上一頁</a></li>                 
                </ul>
            </div>
        </nav>     
            </section>
            <hr class="m-0" />
            <!-- Experience-->
            <section class="resume-section" id="exper">
                <div class="resume-section-content">
                    <h2 class="mb-5">CodeML and CreateML</h2>
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">CreateML是什麼</h3>
                            <div class="subheading mb-3"></div>
                            <p class="makardiv">CreateML 是由一個叫做CoreML的框架開發出來的。CoreML是Apple在2017年的Apple WWDC大會上推出的一個機器學習框架，為了讓開發者不需要花費過多時間去深入瞭解神經網絡以及機器學習的相關知識，也能將機器學習運用在app的製作上。<br>
                                目前CoreML有以下三大運用框架：
                                <ol>
                                    <li>Vision：用於高效能圖片、影片分析。</li>
                                    <li>Foundation：用於協助自然語言處理（如NSLinguisticTagger類）。</li>
                                    <li>GameplayKit：用於在遊戲中導入人工智慧。</li>
                                </ol>                                
                            </p>
                        </div>                       
                    </div>
                    <div class="teachimg2"><img src="img/CodeML/d926fc62-3dea-4447-86fc-920d4d6c4781.png" alt=""></div>                           
                </div>
            </section>
            <hr class="m-0" />
            <!-- Education-->
            <section class="resume-section" id="education">
                <div class="resume-section-content">                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">實作：圖片辨識</h3>
                            <div class="subheading mb-3">#機器學習 #學習新工具</div>
                            <div class="makardiv">那首先要先準備圖片，我這邊準備了狗和貓的圖片，實作辨識狗和貓。<br>

                                我們看到下方圖片，這就是我們進到 CreateML 的操作畫面，將檔案丟到 1 裡面後按下 2。接著我們就可以進到 Preview 裡查看結果了。<br>
                                
                                訓練資料夾的結構為一個母資料夾，裡面存放各種不同種類的子資料夾，圖片檔案格式可包含 jpeg、png、webp
                                <div>
                                    <pre class="code-block"><code class="language-javascript">
├── train
│   ├── category1/
│   │   ├── image1.jpeg
│   │   └── image2.png
│   ├── category2/
│   └── category3/
                                    </code>                                        
                                    </pre>
                                </div>               
                            </div>
                        </div>                                         
                        <div class="flex-shrink-0"><span class="text-primary"> January 2025</span></div>                                 
                    </div>     
                    <div class="teachimg"><img src="img/CodeML/111 2.png" alt=""></div>                 
                </div>
            </section>
            <hr class="m-0" />
            <!-- Skills-->
            <section class="resume-section" id="skills">
                <div class="resume-section-content">                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">展示結果</h3>
                            <div class="subheading mb-3"></div>
                            <div class="makardiv">從下方圖片中我們可以發現辨識結果是相當正確的</div>
                        </div>
                        <div class="flex-shrink-0"><span class="text-primary"> January 2025</span></div>
                    </div>                 
                    <div class="photo-container">
                        <div class="photo1">
                            <img src="img/CodeML/222.png" alt="Photo 1">
                        </div>
                        <div class="photo1">
                            <img src="img/CodeML/333.png" alt="Photo 2">
                        </div>                       
                    </div> 
                </div>
            </section>
            <hr class="m-0" />
            <!-- Interests-->
            <section class="resume-section" id="interests">
                <div class="resume-section-content">                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">結合 SwiftUI</h3>
                            <div class="subheading mb-3">#模型導入 #iOS</div>
                            <div class="makardiv">那如果我們不只是想判斷狗或鳥，我們可以從<a href="https://developer.apple.com/machine-learning/models/?source=post_page-----ce02a92573f6--------------------------------">Apple官方的模型庫</a>來尋找，我這邊是用的是Resnet50Int8LUT。<br>那我們將模型下載下來後丟進 Xcode並貼上下方程式碼，執行後我們就可以得到下方圖片的結果。       
                                <div>
                                    <pre class="code-block"><code class="language-javascript">
import SwiftUI
import CoreML
import UIKit
import UniformTypeIdentifiers

struct ContentView: View {
    @State private var inputImage: UIImage?
    @State private var predictionText = "I think this is a ..."
    @State private var showCameraPicker = false
    @State private var showLibraryPicker = false
    
    private var model: Resnet50Int8LUT?
    
    init() {
        do {
            model = try Resnet50Int8LUT(configuration: MLModelConfiguration())
        } catch {
            print("初始化模型時發生錯誤：\(error)")
        }
    }
    
    var body: some View {
        VStack {
            if let inputImage = inputImage {
                Image(uiImage: inputImage)
                    .resizable()
                    .scaledToFit()
            } else {
                Image(systemName: "photo.fill")
                    .resizable()
                    .scaledToFit()
            }
            
            Text(predictionText)
                .padding()
            
            HStack {
                Button(action: { showCameraPicker = true }) {
                    HStack {
                        Image(systemName: "camera")
                        Text("Camera")
                    }
                    .padding()
                    .foregroundColor(.white)
                    .background(.blue)
                    .cornerRadius(40)
                }
                .sheet(isPresented: $showCameraPicker) {
                    ImagePicker(image: $inputImage, sourceType: .camera, onImagePicked: processImage)
                }
                
                Button(action: { showLibraryPicker = true }) {
                    HStack {
                        Image(systemName: "photo.stack")
                        Text("Library")
                    }
                    .padding()
                    .foregroundColor(.white)
                    .background(.blue)
                    .cornerRadius(40)
                }
                .sheet(isPresented: $showLibraryPicker) {
                    ImagePicker(image: $inputImage, sourceType: .photoLibrary, onImagePicked: processImage)
                }
            }
            .padding()
        }
        .padding()
    }
    
    func processImage(_ image: UIImage) {
        guard let model = model else { return }
        
        UIGraphicsBeginImageContextWithOptions(CGSize(width: 224, height: 224), true, 2.0)
        image.draw(in: CGRect(x: 0, y: 0, width: 224, height: 224))
        let newImage = UIGraphicsGetImageFromCurrentImageContext()!
        UIGraphicsEndImageContext()
        
        guard let pixelBuffer = newImage.toPixelBuffer(pixelFormatType: kCVPixelFormatType_32ARGB, width: 224, height: 224) else {
            return
        }
        
        guard let prediction = try? model.prediction(image: pixelBuffer) else {
            return
        }
        
        let classLabel = cleanClassLabel(prediction.classLabel)
        let probability = prediction.classLabelProbs[prediction.classLabel] ?? 0
        let formattedProbability = String(format: "%.2f%%", probability * 100)
        
        predictionText = "I think this is a \(classLabel) with probability \(formattedProbability)."
    }
    
    func cleanClassLabel(_ classLabel: String) -> String {
        if let commaIndex = classLabel.firstIndex(of: ",") {
            return String(classLabel[..<commaIndex])
        }
        return classLabel
    }
}

struct ImagePicker: UIViewControllerRepresentable {
    @Binding var image: UIImage?
    let sourceType: UIImagePickerController.SourceType
    let onImagePicked: (UIImage) -> Void
    
    func makeCoordinator() -> Coordinator {
        Coordinator(self)
    }
    
    func makeUIViewController(context: UIViewControllerRepresentableContext<ImagePicker>) -> UIImagePickerController {
        let picker = UIImagePickerController()
        picker.delegate = context.coordinator
        picker.sourceType = sourceType
        picker.mediaTypes = [UTType.image.identifier]
        picker.allowsEditing = false
        return picker
    }
    
    func updateUIViewController(_ uiViewController: UIImagePickerController, context: UIViewControllerRepresentableContext<ImagePicker>) {}
    
    class Coordinator: NSObject, UINavigationControllerDelegate, UIImagePickerControllerDelegate {
        let parent: ImagePicker
        
        init(_ parent: ImagePicker) {
            self.parent = parent
        }
        
        func imagePickerController(_ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [UIImagePickerController.InfoKey : Any]) {
            if let uiImage = info[UIImagePickerController.InfoKey.originalImage] as? UIImage {
                parent.image = uiImage
                parent.onImagePicked(uiImage)
            }
            picker.dismiss(animated: true)
        }
    }
}

extension UIImage {
    func toPixelBuffer(pixelFormatType: OSType, width: Int, height: Int) -> CVPixelBuffer? {
        var pixelBuffer: CVPixelBuffer?
        let attrs: [String: NSNumber] = [
            kCVPixelBufferCGImageCompatibilityKey as String: NSNumber(booleanLiteral: true),
            kCVPixelBufferCGBitmapContextCompatibilityKey as String: NSNumber(booleanLiteral: true)
        ]
        
        let status = CVPixelBufferCreate(kCFAllocatorDefault, width, height, pixelFormatType, attrs as CFDictionary, &pixelBuffer)
        guard status == kCVReturnSuccess else { return nil }
        
        CVPixelBufferLockBaseAddress(pixelBuffer!, CVPixelBufferLockFlags(rawValue: 0))
        let pixelData = CVPixelBufferGetBaseAddress(pixelBuffer!)
        let rgbColorSpace = CGColorSpaceCreateDeviceRGB()
        let context = CGContext(data: pixelData, width: width, height: height, bitsPerComponent: 8, bytesPerRow: CVPixelBufferGetBytesPerRow(pixelBuffer!), space: rgbColorSpace, bitmapInfo: CGImageAlphaInfo.noneSkipFirst.rawValue)
        
        context?.translateBy(x: 0, y: CGFloat(height))
        context?.scaleBy(x: 1.0, y: -1.0)
        
        UIGraphicsPushContext(context!)
        draw(in: CGRect(x: 0, y: 0, width: CGFloat(width), height: CGFloat(height)))
        UIGraphicsPopContext()
        
        CVPixelBufferUnlockBaseAddress(pixelBuffer!, CVPixelBufferLockFlags(rawValue: 0))
        return pixelBuffer
    }
}

                                    </code>                                        
                                    </pre>
                                </div>                                        
                            </div>                            
                        </div>
                        <div class="flex-shrink-0"><span class="text-primary">September 2024</span></div>                        
                    </div>                    
                    <div class="teachimg"><img src="img/CodeML/555.png" alt=""></div>                      
                </div>
            </section>           
            <hr class="m-0" />
            <!-- Education-->
            <section class="resume-section" id="word">
                <div class="resume-section-content">                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">心得感想</h3>
                            <div class="subheading mb-3">#介紹 ＃逐字稿 ＃玩後解說</div>
                            <div class="makardiv">開場前情提要：<br>
                                歡迎大家來玩科技進階密室逃脫，在這次的遊戲中你們扮演的是一群失憶的科學家收到神秘郵件來到這裡，我作為NPC在這裡能給的提示是：請詳細閱讀每一分文件以及越不合理的解法有可能就是正解。<br>                           
                                遊戲後解說：<br>
                                在第一關我們想要表達的是密碼不應該直接貼在螢幕上，即便他已經是加密過的摩斯密碼但仍然不應該這樣紀錄，另外如果有網頁或資安相關專業的應該會下意識打開F12查HTML，這時候你就會發現這個網頁的密碼驗證是寫在前端，那這在製作網站時也是不應該出現的寫法。我們破解網頁後就可以發現這邊有一份文件，那這個文件裡有寫說：「保險箱的密碼好像是文件日期」，而我們查看文件日期是2/13，那麼我們在根據附圖的小地圖就可以發現保險箱的存在，將保險箱的密碼轉到213就可以破解。那像這樣將密碼保存在電子郵件的方式是不恰當的，很容易被發現。
                                那我們閱讀第二關中的文件可以發現，裡面寫說：「某次大停電保險箱突然打開，不知道有沒有被修復」，那這段文字是想要讓玩家嘗試將電源拔掉，在資訊安全中，駭客可能會透過讓伺服器斷電在重啟的方式竊取資料。那打開保險箱後我們可以發現密碼盤的線是完全沒有接東西的。
                                透過第三關的文件我們可以了解到許多科學家的指紋都被竊取下來了，而這些指紋就散落在保險箱附近，那我們從中找出跟保險箱上指紋相同的磁扣放上去後就能打開保險箱。那這個關卡主要是想要傳達不要將指紋上傳到網路上，會有很多個資上的問題。
                                在第四關的文件中我們了解到有一個工程師設計了一個電流急急棒保險箱，但鐵絲跟電線的地方似乎沒接好，那這句話其實是希望各位將保險箱上的電線和鐵絲分離，然後將鐵絲直接套到終點然後再接電，這樣就可以直接將保險箱打開。
                                那透過第五關的文件我們可以發現我們已經來到最終關卡了，文件寫說修復時間機器的方法就是將所有零件組裝上並插上正確的鑰匙，那我們透過接線圖上的提示將線接好後插上正確的鑰匙後時間機器就修好了。
                                以上就是整個密室逃脫的解說，謝謝大家</div>
                        </div>                                         
                        <div class="flex-shrink-0"><span class="text-primary">September 2024</span></div>                                 
                    </div>     
                    <!-- <div class="teachimg"><img src="img/clonepj/github.png" alt=""></div>                  -->
                </div>
            </section>                   
        </div>
        <!-- Bootstrap core JS-->
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <script>
            var myIndex = 0;
            carousel();
            
            function carousel() {
              var i;
              var x = document.getElementsByClassName("mySlides");
              for (i = 0; i < x.length; i++) {
                x[i].style.display = "none";  
              }
              myIndex++;
              if (myIndex > x.length) {myIndex = 1}    
              x[myIndex-1].style.display = "block";  
              setTimeout(carousel, 9000);    
            }
            </script>
            <script>
                document.addEventListener("DOMContentLoaded", function() {
                    new ClipboardJS('.copy-btn');
                
                    document.querySelectorAll('.copy-btn').forEach(button => {
                        button.addEventListener('click', () => {
                            button.textContent = "Copied!";
                            setTimeout(() => (button.textContent = "Copy"), 1500);
                        });
                    });
                });
            </script>                
    </body>
</html>
